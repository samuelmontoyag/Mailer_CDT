{% extends "index.html" %}
{% block body %}

<h2>Detalles lista correos</h2>
<h3>{{ list.name }}</h3>
<div>
    <button class="btn btn-primary btn-sm"  data-toggle="modal" data-target="#addEmail">
      Agregar nuevo correo
    </button>
    <button class="btn btn-default btn-sm"  data-toggle="modal" data-target="#importCSV">
      importar correos desde CSV
    </button>
</div>
{% if message != None %}
   {{message|safe}}
{% endif %}

<h2>Sublistas de correo</h2>
<table class="table table-bordered">
    <tr>
        <th>Nombre lista</th>
        <th>Cantidad usuarios</th>
    </tr>
    <tr>
        <td>Todos</td>
        <td>{{ list.stats.member_count }}</td>
    </tr>
    {% for member in members %}
    <tr>
        <td>{{ member.merges['FNAME'] }}</td>
        <td>{{ member.merges['LNAME'] }}</td>
    </tr>
    {% endfor %}
</table>

<div class="modal fade" id="addEmail">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="POST" action="/correos/add">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Agregar nuevo correo</h4>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="id" value="{{list.id}}" >
                    <div>
                        <label>Nombres</label>
                        <div>
                            <input type="text" name="name" placeholder="Nombres">
                        </div>
                    </div>
                    <div>
                        <label>Apellidos</label>
                        <div>
                            <input type="text" name="lastName" placeholder="apellidos">
                        </div>
                    </div>
                    <div>
                        <label>Email</label>
                        <div>
                            <input type="text" name="email" placeholder="email">
                        </div>
                    </div>  
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Agregar</button>
                </div>
            </form>
        </div>
  </div>
</div>

<div class="modal fade" id="importCSV">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="POST" action="/correos/import_preview" enctype="multipart/form-data">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Importar desde CSV</h4>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="id" value="{{list.id}}" >
                    <input type="hidden" name="list_name" value="{{list.name}}" >
                    <div>
                        <label>Archivo</label>
                        <div>
                            <input type="file" name="emailsFile">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Continuar</button>
                </div>
            </form>
        </div>
  </div>
</div>
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="POST" id="confirmDeleteForm" action="/correos/delete">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title" id="myModalLabel">Eliminar Mail</h4>
          </div>
          <div class="modal-body">
            esta a punto de eliminar el email <strong id="emailDelText"></strong>.
            <div class="alert alert-danger">
                Â¿Estas Seguro?.
            </div>
            <div class="checkbox">
                <label>
                    <input type="checkbox" name="delete">Eliminar todos los datos de este usuario.
                </label>
            </div>
            <div class="checkbox">
                <label>
                    <input type="checkbox" name="notify"> notificar de la eliminacion al usuario.
                </label>
            </div>
          </div>
          <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
            <input type="hidden" name="euid" value="0" id="deleteID">
            <input type="hidden" name="emailDel" value="0" id="emailDel">
            <input type="hidden" name="listId" value="{{list.id}}" >

            <button type="submit" id="confirmDelete" class="btn btn-primary">Eliminar</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script type="text/javascript">
var euid 
    $(function(){
        $(".deleteModal").on("click", function () {
            euid = $(this).data('id');
            $("#emailDelText").text($('#'+euid).text());
            $("#emailDel").val($('#'+euid).text());
            $('euid').val(euid);

        })
        $("#confirmDelete").on("click", function () {
            $("#confirmDelete").text("Eliminando ...");
            $("#confirmDelete").attr("disabled", "disabled");
            $("#confirmDeleteForm").submit()
        });
    })
</script>
{% endblock %}